#include "Test.h"

bool test(solver::HiddenMultiType multiType, const std::string &puzzle, const std::string &board,
          solver::Technique expectedTechnique, const CellLogs &expectedCellLogs)
{
    Grid grid;
    grid.fillBoard(board);

    solver::Logs logs;
    bool changed = solver::techniques::hiddenMulti(grid, multiType, &logs);

    return checkAll(puzzle, grid, board, changed, expectedTechnique, expectedCellLogs, logs);
}

int main(int, char **)
{
    // (1,3) (1,6)
    if (!test(solver::HiddenMultiType::Pair, // Row
              "6.5...14.914.5..3..37........3941..2..23.5914149.28..3..1...39..78.9.4.1.96...7.8",
              R"(
                .------------.-----------------.----------------.
                | 6    28  5 | 278    378  39  | 1     4    79  |
                | 9    1   4 | 278    5    67  | 28    3    67  |
                | 28   3   7 | 14     16   49  | 2568  568  569 |
                :------------+-----------------+----------------:
                | 57   56  3 | 9      4    1   | 68    678  2   |
                | 78   68  2 | 3      67   5   | 9     1    4   |
                | 1    4   9 | 67     2    8   | 56    567  3   |
                :------------+-----------------+----------------:
                | 245  25  1 | 45678  678  67  | 3     9    56  |
                | 35   7   8 | 56     9    23  | 4     256  1   |
                | 345  9   6 | 145    13   234 | 7     25   8   |
                '------------'-----------------'----------------'
              )",
              solver::Technique::HiddenPair,
              {
                  // Pattern
                  CL(1, 3, CA::InPatternN1, 2), CL(1, 3, CA::InPatternN1, 8), CL(1, 6, CA::InPatternN1, 2), //
                  CL(1, 6, CA::InPatternN1, 8),                                                             //

                  // Remove
                  CL(1, 3, CA::RemovedNote, 7) //
              }))
        return failed();

    // (0,0) (0,1) .....
    // ..... ..... .....
    // ..... ..... .....
    if (!test(solver::HiddenMultiType::Pair, // row/block
              "....6........42736..673..4..94....68....964.76.7.5.9231......85.6..8.271..5.1..94",
              R"(
                .-------------------------.-----------------.-------------.
                | 2345789  1234578  12389 | 1589   6   1589 | 158  15  29 |
                | 589      158      189   | 1589   4   2    | 7    3   6  |
                | 2589     1258     6     | 7      3   1589 | 158  4   29 |
                :-------------------------+-----------------+-------------:
                | 235      9        4     | 123    27  137  | 15   6   8  |
                | 2358     12358    1238  | 1238   9   6    | 4    15  7  |
                | 6        18       7     | 148    5   148  | 9    2   3  |
                :-------------------------+-----------------+-------------:
                | 1        2347     239   | 23469  27  3479 | 36   8   5  |
                | 349      6        39    | 3459   8   3459 | 2    7   1  |
                | 2378     2378     5     | 236    1   37   | 36   9   4  |
                '-------------------------'-----------------'-------------'
              )",
              solver::Technique::HiddenPair,
              {
                  // Pattern
                  CL(0, 0, CA::InPatternN1, 4), CL(0, 1, CA::InPatternN1, 4), //
                  CL(0, 0, CA::InPatternN1, 7), CL(0, 1, CA::InPatternN1, 7), //

                  // Remove
                  CL(0, 0, CA::RemovedNote, 2), CL(0, 1, CA::RemovedNote, 1), //
                  CL(0, 0, CA::RemovedNote, 3), CL(0, 1, CA::RemovedNote, 2), //
                  CL(0, 0, CA::RemovedNote, 5), CL(0, 1, CA::RemovedNote, 3), //
                  CL(0, 0, CA::RemovedNote, 8), CL(0, 1, CA::RemovedNote, 5), //
                  CL(0, 0, CA::RemovedNote, 9), CL(0, 1, CA::RemovedNote, 8)  //
              }))
        return failed();

    // (4,8)
    // (6,8)
    if (!test(solver::HiddenMultiType::Pair, // column
              ".49132....81479...327685914.96.518...75.28....38.46..5853267...712894563964513...",
              R"(
                .----------.----------.-----------------.
                | 56  4  9 | 1   3  2 | 67    578   678 |
                | 56  8  1 | 4   7  9 | 236   235   26  |
                | 3   2  7 | 6   8  5 | 9     1     4   |
                :----------+----------+-----------------:
                | 24  9  6 | 37  5  1 | 8     2347  27  |
                | 14  7  5 | 39  2  8 | 1346  349   169 |
                | 12  3  8 | 79  4  6 | 127   279   5   |
                :----------+----------+-----------------:
                | 8   5  3 | 2   6  7 | 14    49    19  |
                | 7   1  2 | 8   9  4 | 5     6     3   |
                | 9   6  4 | 5   1  3 | 27    278   278 |
                '----------'----------'-----------------'
              )",
              solver::Technique::HiddenPair,
              {
                  // Pattern
                  CL(4, 8, CA::InPatternN1, 1), CL(4, 8, CA::InPatternN1, 9), //
                  CL(6, 8, CA::InPatternN1, 1), CL(6, 8, CA::InPatternN1, 9), //

                  // Remove
                  CL(4, 8, CA::RemovedNote, 6) //
              }))
        return failed();

    // ..... ..... .....
    // ..... (1,4) .....
    // ..... (2,4) .....
    if (!test(solver::HiddenMultiType::Pair, // column/block
              "9.8.6...41.......875.8.912....3...5..7.9.4.8..1...2....81..3.493...9....6...2...5",
              R"(
                .----------------.--------------------.-------------------.
                | 9   23    8    | 1257   6     157   | 357    37    4    |
                | 1   2346  246  | 257    3457  57    | 35679  3679  8    |
                | 7   5     46   | 8      34    9     | 1      2     36   |
                :----------------+--------------------+-------------------:
                | 48  269   269  | 3      178   67    | 24679  5     1267 |
                | 25  7     2356 | 9      15    4     | 236    8     1236 |
                | 48  1     3569 | 567    578   2     | 34679  3679  367  |
                :----------------+--------------------+-------------------:
                | 25  8     1    | 567    57    3     | 267    4     9    |
                | 3   24    2457 | 14567  9     15678 | 2678   167   267  |
                | 6   49    479  | 147    2     178   | 378    137   5    |
                '----------------'--------------------'-------------------'
              )",
              solver::Technique::HiddenPair,
              {
                  // Pattern
                  CL(1, 4, CA::InPatternN1, 3), CL(1, 4, CA::InPatternN1, 4), //
                  CL(2, 4, CA::InPatternN1, 3), CL(2, 4, CA::InPatternN1, 4), //

                  // Remove
                  CL(1, 4, CA::RemovedNote, 5), CL(1, 4, CA::RemovedNote, 7) //
              }))
        return failed();

    // ..... ..... .....
    // ..... (4,7) .....
    // ..... ..... (5,8)
    if (!test(solver::HiddenMultiType::Pair, // block
              ".1.........3...6..7.6284.3..68.29..52..4.5..84..8...2..8.693..7..7...9.........5.",
              R"(
                .------------------.-----------------.--------------------.
                | 589   1     24   | 3579  3567  67  | 24578  4789  249   |
                | 589   24    3    | 1579  157   17  | 6      4789  249   |
                | 7     59    6    | 2     8     4   | 15     3     19    |
                :------------------+-----------------+--------------------:
                | 13    6     8    | 137   2     9   | 1347   147   5     |
                | 2     379   19   | 4     1367  5   | 137    1679  8     |
                | 4     3579  159  | 8     1367  167 | 137    2     1369  |
                :------------------+-----------------+--------------------:
                | 15    8     1245 | 6     9     3   | 124    14    7     |
                | 136   234   7    | 15    145   28  | 9      1468  12346 |
                | 1369  2349  1249 | 17    147   28  | 12348  5     12346 |
                '------------------'-----------------'--------------------'
              )",
              solver::Technique::HiddenPair,
              {
                  // Pattern
                  CL(4, 7, CA::InPatternN1, 6), CL(4, 7, CA::InPatternN1, 9), //
                  CL(5, 8, CA::InPatternN1, 6), CL(5, 8, CA::InPatternN1, 9), //

                  // Remove
                  CL(4, 7, CA::RemovedNote, 1), CL(4, 7, CA::RemovedNote, 7), //
                  CL(5, 8, CA::RemovedNote, 1), CL(5, 8, CA::RemovedNote, 3)  //
              }))
        return failed();

    // (6,1) (6,2) (6,4)
    if (!test(solver::HiddenMultiType::Triple, // row
              "965147823148.....77..685194...2.93.838.75.2.9291834.7......89..8.....7.26.957.481",
              R"(
                .---------------.--------------.-------------.
                | 9   6    5    | 1    4    7  | 8   2    3  |
                | 1   4    8    | 39   29   23 | 56  56   7  |
                | 7   23   23   | 6    8    5  | 1   9    4  |
                :---------------+--------------+-------------:
                | 45  57   467  | 2    16   9  | 3   14   8  |
                | 3   8    46   | 7    5    16 | 2   14   9  |
                | 2   9    1    | 8    3    4  | 56  7    56 |
                :---------------+--------------+-------------:
                | 45  157  2347 | 34   126  8  | 9   356  56 |
                | 8   15   34   | 349  169  16 | 7   356  2  |
                | 6   23   9    | 5    7    23 | 4   8    1  |
                '---------------'--------------'-------------'
              )",
              solver::Technique::HiddenTriple,
              {
                  // Pattern
                  CL(6, 1, CA::InPatternN1, 1), CL(6, 1, CA::InPatternN1, 7), CL(6, 2, CA::InPatternN1, 2), //
                  CL(6, 2, CA::InPatternN1, 7), CL(6, 4, CA::InPatternN1, 1), CL(6, 4, CA::InPatternN1, 2), //

                  // Remove
                  CL(6, 1, CA::RemovedNote, 5), CL(6, 2, CA::RemovedNote, 3), CL(6, 2, CA::RemovedNote, 4), //
                  CL(6, 4, CA::RemovedNote, 6)                                                              //
              }))
        return failed();

    // (3,5)
    // (5,5)
    // (7,5)
    if (!test(solver::HiddenMultiType::Triple,
              "5..62..37..489........5....93........2....6.57.......3.....9.........7..68.57...2",
              R"(
                .---------------------.-----------------------.----------------------.
                | 5     19    189     | 6      2      14      | 1489   3       7     |
                | 123   167   4       | 8      9      137     | 125    1256    16    |
                | 1238  1679  1236789 | 1347   5      1347    | 12489  124689  14689 |
                :---------------------+-----------------------+----------------------:
                | 9     3     1568    | 1247   1468   1245678 | 1248   12478   148   |
                | 148   2     18      | 13479  1348   13478   | 6      14789   5     |
                | 7     1456  1568    | 1249   1468   124568  | 12489  12489   3     |
                :---------------------+-----------------------+----------------------:
                | 1234  1457  12357   | 1234   13468  9       | 13458  14568   1468  |
                | 1234  1459  12359   | 1234   13468  123468  | 7      145689  14689 |
                | 6     8     139     | 5      7      134     | 1349   149     2     |
                '---------------------'-----------------------'----------------------'
              )",
              solver::Technique::HiddenTriple,
              {
                  // Pattern
                  CL(3, 5, CA::InPatternN1, 2), CL(3, 5, CA::InPatternN1, 5), CL(3, 5, CA::InPatternN1, 6), //
                  CL(5, 5, CA::InPatternN1, 2), CL(5, 5, CA::InPatternN1, 5), CL(5, 5, CA::InPatternN1, 6), //
                  CL(7, 5, CA::InPatternN1, 2), CL(7, 5, CA::InPatternN1, 6),                               //

                  // Remove
                  CL(3, 5, CA::RemovedNote, 1), CL(3, 5, CA::RemovedNote, 4), CL(3, 5, CA::RemovedNote, 7), //
                  CL(3, 5, CA::RemovedNote, 8),                                                             //
                  CL(5, 5, CA::RemovedNote, 1), CL(5, 5, CA::RemovedNote, 4), CL(5, 5, CA::RemovedNote, 8), //
                  CL(7, 5, CA::RemovedNote, 1), CL(7, 5, CA::RemovedNote, 3), CL(7, 5, CA::RemovedNote, 4), //
                  CL(7, 5, CA::RemovedNote, 8)                                                              //
              }))
        return failed();

    // (0,3)
    // (5,3)
    // (8,3)
    if (!test(solver::HiddenMultiType::Triple,
              "478.2.61.9.14.827.5.2.7...96.483...27.9.4.3..823.15.64197.8.5.6285.....7346....2.",
              R"(
                .----------.---------------.--------------.
                | 4  7   8 | 359  2   39   | 6    1    35 |
                | 9  36  1 | 4    56  8    | 2    7    35 |
                | 5  36  2 | 136  7   136  | 48   48   9  |
                :----------+---------------+--------------:
                | 6  15  4 | 8    3   79   | 179  59   2  |
                | 7  15  9 | 26   4   26   | 3    58   18 |
                | 8  2   3 | 79   1   5    | 79   6    4  |
                :----------+---------------+--------------:
                | 1  9   7 | 23   8   234  | 5    34   6  |
                | 2  8   5 | 136  69  1346 | 149  349  7  |
                | 3  4   6 | 157  59  17   | 189  2    18 |
                '----------'---------------'--------------'
              )",
              solver::Technique::HiddenTriple,
              {
                  // Pattern
                  CL(0, 3, CA::InPatternN1, 5), CL(0, 3, CA::InPatternN1, 9), //
                  CL(5, 3, CA::InPatternN1, 7), CL(5, 3, CA::InPatternN1, 9), //
                  CL(8, 3, CA::InPatternN1, 5), CL(8, 3, CA::InPatternN1, 7), //

                  // Remove
                  CL(0, 3, CA::RemovedNote, 3), //
                  CL(8, 3, CA::RemovedNote, 1)  //
              }))
        return failed();

    // ..... ..... .....
    // ..... (7,1) .....
    // ..... (8,1) (8,2)
    if (!test(solver::HiddenMultiType::Triple,
              "28....473534827196.71.34.8.3..5...4....34..6.46.79.31..9.2.3654..3..9821....8.937",
              R"(
                .-------------------.----------------.--------------.
                | 2     8     69    | 169  156  156  | 4    7  3    |
                | 5     3     4     | 8    2    7    | 1    9  6    |
                | 69    7     1     | 69   3    4    | 25   8  25   |
                :-------------------+----------------+--------------:
                | 3     12    2789  | 5    16   1268 | 27   4  289  |
                | 1789  125   25789 | 3    4    128  | 257  6  2589 |
                | 4     6     258   | 7    9    28   | 3    1  258  |
                :-------------------+----------------+--------------:
                | 178   9     78    | 2    17   3    | 6    5  4    |
                | 67    45    3     | 46   567  9    | 8    2  1    |
                | 16    1245  256   | 146  8    156  | 9    3  7    |
                '-------------------'----------------'--------------'
              )",
              solver::Technique::HiddenTriple,
              {
                  // Pattern
                  CL(7, 1, CA::InPatternN1, 4), CL(7, 1, CA::InPatternN1, 5),                               //
                  CL(8, 1, CA::InPatternN1, 2), CL(8, 1, CA::InPatternN1, 4), CL(8, 1, CA::InPatternN1, 5), //
                  CL(8, 2, CA::InPatternN1, 2), CL(8, 2, CA::InPatternN1, 5),                               //

                  // Remove
                  CL(8, 1, CA::RemovedNote, 1), CL(8, 2, CA::RemovedNote, 6) //
              }))
        return failed();

    // (4,0) (4,2) (4,6) (4,8)
    if (!test(solver::HiddenMultiType::Quadruple,
              "6.1.7..3..3.5.176..57936.1.41..658.............871..43.9.6.835.3.6157.8...5.....6",
              R"(
                .----------------.------------------.---------------.
                | 6     248  1   | 248   7     24   | 59   3    59  |
                | 289   3    249 | 5     248   1    | 7    6    28  |
                | 28    5    7   | 9     3     6    | 24   1    248 |
                :----------------+------------------+---------------:
                | 4     1    239 | 23    6     5    | 8    279  27  |
                | 2579  267  239 | 2348  2489  2349 | 156  29   15  |
                | 259   26   8   | 7     1     29   | 56   4    3   |
                :----------------+------------------+---------------:
                | 17    9    24  | 6     24    8    | 3    5    17  |
                | 3     24   6   | 1     5     7    | 249  8    249 |
                | 178   78   5   | 234   249   2349 | 124  27   6   |
                '----------------'------------------'---------------'
              )",
              solver::Technique::HiddenQuadruple,
              {
                  // Pattern
                  CL(4, 0, CA::InPatternN1, 5), CL(4, 0, CA::InPatternN1, 7), CL(4, 1, CA::InPatternN1, 6), //
                  CL(4, 1, CA::InPatternN1, 7), CL(4, 6, CA::InPatternN1, 1), CL(4, 6, CA::InPatternN1, 5), //
                  CL(4, 6, CA::InPatternN1, 6), CL(4, 8, CA::InPatternN1, 1), CL(4, 8, CA::InPatternN1, 5), //

                  // Remove
                  CL(4, 0, CA::RemovedNote, 2), CL(4, 0, CA::RemovedNote, 9), CL(4, 1, CA::RemovedNote, 2) //
              }))
        return failed();

    // (0,8)
    // (1,8)
    // (2,8)
    // (7,8)
    if (!test(solver::HiddenMultiType::Quadruple,
              ".3.....1...8.9....4..6.8......57694....98352....124...276..519....7.9....95...47.",
              R"(
                .------------------.---------------.---------------------.
                | 5679  3     279  | 24   45   27  | 2678  1     2456789 |
                | 567   1256  8    | 234  9    127 | 2367  356   234567  |
                | 4     125   1279 | 6    135  8   | 237   35    23579   |
                :------------------+---------------+---------------------:
                | 138   128   123  | 5    7    6   | 9     4     138     |
                | 67    146   147  | 9    8    3   | 5     2     167     |
                | 5679  568   379  | 1    2    4   | 3678  368   3678    |
                :------------------+---------------+---------------------:
                | 2     7     6    | 348  34   5   | 1     9     38      |
                | 138   148   134  | 7    136  9   | 2368  3568  23568   |
                | 138   9     5    | 238  136  12  | 4     7     368     |
                '------------------'---------------'---------------------'
              )",
              solver::Technique::HiddenQuadruple,
              {
                  // Pattern
                  CL(0, 8, CA::InPatternN1, 2), CL(0, 8, CA::InPatternN1, 4), CL(0, 8, CA::InPatternN1, 5), //
                  CL(0, 8, CA::InPatternN1, 9),                                                             //
                  CL(1, 8, CA::InPatternN1, 2), CL(1, 8, CA::InPatternN1, 4), CL(1, 8, CA::InPatternN1, 5), //
                  CL(2, 8, CA::InPatternN1, 2), CL(2, 8, CA::InPatternN1, 5), CL(2, 8, CA::InPatternN1, 9), //
                  CL(7, 8, CA::InPatternN1, 2), CL(7, 8, CA::InPatternN1, 5),                               //

                  // Remove
                  CL(0, 8, CA::RemovedNote, 6), CL(0, 8, CA::RemovedNote, 7), CL(0, 8, CA::RemovedNote, 8), //
                  CL(1, 8, CA::RemovedNote, 3), CL(1, 8, CA::RemovedNote, 6), CL(1, 8, CA::RemovedNote, 7), //
                  CL(2, 8, CA::RemovedNote, 3), CL(2, 8, CA::RemovedNote, 7),                               //
                  CL(7, 8, CA::RemovedNote, 3), CL(7, 8, CA::RemovedNote, 6), CL(7, 8, CA::RemovedNote, 8)  //
              }))
        return failed();

    // ..... (6,4) (6,5)
    // ..... (7,4) (7,5)
    // ..... ..... .....
    if (!test(solver::HiddenMultiType::Quadruple,
              "816573294392......4572.9..6941...5687854961236238...4.279.....1138....7.564....82",
              R"(
                .---------.------------------.------------.
                | 8  1  6 | 5     7      3   | 2   9   4  |
                | 3  9  2 | 16    1468   148 | 78  15  57 |
                | 4  5  7 | 2     18     9   | 38  13  6  |
                :---------+------------------+------------:
                | 9  4  1 | 37    23     27  | 5   6   8  |
                | 7  8  5 | 4     9      6   | 1   2   3  |
                | 6  2  3 | 8     15     15  | 79  4   79 |
                :---------+------------------+------------:
                | 2  7  9 | 36    34568  458 | 46  35  1  |
                | 1  3  8 | 69    2456   245 | 46  7   59 |
                | 5  6  4 | 1379  13     17  | 39  8   2  |
                '---------'------------------'------------'
              )",
              solver::Technique::HiddenQuadruple,
              {
                  // Pattern
                  CL(6, 4, CA::InPatternN1, 4), CL(6, 4, CA::InPatternN1, 5), CL(6, 4, CA::InPatternN1, 8), //
                  CL(6, 5, CA::InPatternN1, 4), CL(6, 5, CA::InPatternN1, 5), CL(6, 5, CA::InPatternN1, 8), //
                  CL(7, 4, CA::InPatternN1, 2), CL(7, 4, CA::InPatternN1, 4), CL(7, 4, CA::InPatternN1, 5), //
                  CL(7, 5, CA::InPatternN1, 2), CL(7, 5, CA::InPatternN1, 4), CL(7, 5, CA::InPatternN1, 5), //

                  // Remove
                  CL(6, 4, CA::RemovedNote, 3), CL(6, 4, CA::RemovedNote, 6), //
                  CL(7, 4, CA::RemovedNote, 6)                                //
              }))
        return failed();

    return passed();
}