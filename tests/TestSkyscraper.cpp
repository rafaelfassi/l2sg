#include "Test.h"

bool test(const std::string &puzzle, const std::string &board, solver::Technique expectedTechnique,
          const CellLogs &expectedCellLogs)
{
    Grid grid;
    grid.fillBoard(board);

    solver::Logs logs;
    bool changed = solver::techniques::skyscraper(grid, &logs);

    return checkAll(puzzle, grid, board, changed, expectedTechnique, expectedCellLogs, logs);
}

int main(int, char **)
{
    // row
    // (0,2) ..... (0,5)
    // (8,2) (8,3) .....
    if (!test("12.....7.7.6.2..18385147629468.1.957517498236932756..16.1534..28.3...1.525...1.6.",
              R"(
                .------------.--------------.-------------.
                | 1  2    49 | 68   68  359 | 35   7   34 |
                | 7  49   6  | 39   2   359 | 345  1   8  |
                | 3  8    5  | 1    4   7   | 6    2   9  |
                :------------+--------------+-------------:
                | 4  6    8  | 23   1   23  | 9    5   7  |
                | 5  1    7  | 4    9   8   | 2    3   6  |
                | 9  3    2  | 7    5   6   | 48   48  1  |
                :------------+--------------+-------------:
                | 6  79   1  | 5    3   4   | 78   89  2  |
                | 8  479  3  | 269  67  29  | 1    49  5  |
                | 2  5    49 | 89   78  1   | 37   6   34 |
                '------------'--------------'-------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(0, 2, CA::RelatedNote, 9), CL(0, 5, CA::RelatedNote, 9), //
                  CL(8, 2, CA::RelatedNote, 9), CL(8, 3, CA::RelatedNote, 9), //

                  // Remove
                  CL(1, 3, CA::RemovedNote, 9), //
                  CL(7, 5, CA::RemovedNote, 9)  //
              }))
        return failed();

    // row
    // ..... (1,2) (1,8)
    // (8,1) ..... (8,8)
    if (!test("..13928.439.874.1..48615.3.925137648184526397..3489.5..3.96.4..41.25....8.974..2.",
              R"(
                .--------------.----------.--------------.
                | 567  567  1  | 3  9  2  | 8   67   4   |
                | 3    9    26 | 8  7  4  | 25  1    256 |
                | 27   4    8  | 6  1  5  | 79  3    29  |
                :--------------+----------+--------------:
                | 9    2    5  | 1  3  7  | 6   4    8   |
                | 1    8    4  | 5  2  6  | 3   9    7   |
                | 67   67   3  | 4  8  9  | 12  5    12  |
                :--------------+----------+--------------:
                | 25   3    27 | 9  6  18 | 4   78   15  |
                | 4    1    67 | 2  5  38 | 79  678  369 |
                | 8    56   9  | 7  4  13 | 15  2    36  |
                '--------------'----------'--------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(1, 2, CA::RelatedNote, 6), CL(1, 8, CA::RelatedNote, 6), //
                  CL(8, 1, CA::RelatedNote, 6), CL(8, 8, CA::RelatedNote, 6), //

                  // Remove
                  CL(0, 1, CA::RemovedNote, 6), //
                  CL(7, 2, CA::RemovedNote, 6)  //
              }))
        return failed();

    // row
    // (1,1) ..... (1,3)
    // ..... (4,2) (4,3)
    if (!test(".9.6....84.7.89536863754921.5....28..7...8.5...8....1.28.9.71...498.....7....689.",
              R"(
                .----------------.------------------.----------------.
                | 15    9   125  | 6     123   123  | 47    47  8    |
                | 4     12  7    | 12    8     9    | 5     3   6    |
                | 8     6   3    | 7     5     4    | 9     2   1    |
                :----------------+------------------+----------------:
                | 1369  5   146  | 134   679   13   | 2     8   3479 |
                | 1369  7   1246 | 1234  69    8    | 346   5   349  |
                | 369   23  8    | 2345  679   235  | 3467  1   3479 |
                :----------------+------------------+----------------:
                | 2     8   56   | 9     34    7    | 1     46  345  |
                | 1356  4   9    | 8     123   1235 | 37    67  2357 |
                | 7     13  15   | 1235  1234  6    | 8     9   2345 |
                '----------------'------------------'----------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(1, 1, CA::RelatedNote, 2), CL(1, 3, CA::RelatedNote, 2), //
                  CL(4, 2, CA::RelatedNote, 2), CL(4, 3, CA::RelatedNote, 2), //

                  // Remove
                  CL(0, 2, CA::RemovedNote, 2), //
                  CL(5, 1, CA::RemovedNote, 2)  //
              }))
        return failed();

    // row
    // (4,2) (4,6) .....
    // (8,2) ..... (8,7)
    if (!test("8.934.....416.2..3.3691.4.......13..61..3..47..32.4........653.1..4.3.6.36..5.8.4",
              R"(
                .---------------------.----------------.-----------------.
                | 8      257    9     | 3    4     57  | 16  1257  1256  |
                | 57     4      1     | 6    78    2   | 79  5789  3     |
                | 257    3      6     | 9    1     578 | 4   2578  258   |
                :---------------------+----------------+-----------------:
                | 24579  25789  24578 | 578  6789  1   | 3   258   25689 |
                | 6      1      258   | 58   3     89  | 29  4     7     |
                | 579    5789   3     | 2    6789  4   | 16  158   15689 |
                :---------------------+----------------+-----------------:
                | 2479   2789   2478  | 178  2789  6   | 5   3     129   |
                | 1      25789  2578  | 4    2789  3   | 27  6     29    |
                | 3      6      27    | 17   5     79  | 8   1279  4     |
                '---------------------'----------------'-----------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(4, 2, CA::RelatedNote, 2), CL(4, 6, CA::RelatedNote, 2), //
                  CL(8, 2, CA::RelatedNote, 2), CL(8, 7, CA::RelatedNote, 2), //

                  // Remove
                  CL(3, 7, CA::RemovedNote, 2), //
                  CL(7, 6, CA::RemovedNote, 2)  //
              }))
        return failed();

    // row
    // (3,5) ..... (3,8)
    // (8,5) (8,7) .....
    if (!test(".82.64739.3789.24664932758131....69...69134.8.9...61738.1.5936..63..89..9..63.8..",
              R"(
                .---------------.---------------.--------------.
                | 15   8    2   | 15    6    4  | 7  3    9    |
                | 15   3    7   | 8     9    15 | 2  4    6    |
                | 6    4    9   | 3     2    7  | 5  8    1    |
                :---------------+---------------+--------------:
                | 3    1    48  | 47    478  25 | 6  9    25   |
                | 27   257  6   | 9     1    3  | 4  25   8    |
                | 24   9    458 | 25    48   6  | 1  7    3    |
                :---------------+---------------+--------------:
                | 8    27   1   | 247   5    9  | 3  6    247  |
                | 247  6    3   | 1247  47   8  | 9  125  2457 |
                | 9    57   45  | 6     3    12 | 8  12   47   |
                '---------------'---------------'--------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(3, 5, CA::RelatedNote, 2), CL(3, 8, CA::RelatedNote, 2), //
                  CL(8, 5, CA::RelatedNote, 2), CL(8, 7, CA::RelatedNote, 2), //

                  // Remove
                  CL(4, 7, CA::RemovedNote, 2), //
                  CL(6, 8, CA::RemovedNote, 2), //
                  CL(7, 8, CA::RemovedNote, 2)  //
              }))
        return failed();

    // column
    // (2,2) (2,6)
    // (7,2) .....
    // ..... (8,6)
    if (!test("..82635...569718.4.1.845......389457584712693937456..8...197.858..5.47....56.8.4.",
              R"(
                .-----------------.----------.------------------.
                | 47    479  8    | 2  6   3 | 5     17    19   |
                | 23    5    6    | 9  7   1 | 8     23    4    |
                | 237   1    239  | 8  4   5 | 239   2367  269  |
                :-----------------+----------+------------------:
                | 126   26   12   | 3  8   9 | 4     5     7    |
                | 5     8    4    | 7  1   2 | 6     9     3    |
                | 9     3    7    | 4  5   6 | 12    12    8    |
                :-----------------+----------+------------------:
                | 46    46   23   | 1  9   7 | 23    8     5    |
                | 8     29   1239 | 5  23  4 | 7     1236  1269 |
                | 1237  279  5    | 6  23  8 | 1239  4     129  |
                '-----------------'----------'------------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(2, 2, CA::RelatedNote, 9), CL(2, 6, CA::RelatedNote, 9), //
                  CL(7, 2, CA::RelatedNote, 9),                               //
                  CL(8, 6, CA::RelatedNote, 9),                               //

                  // Remove
                  CL(7, 8, CA::RemovedNote, 9), //
                  CL(8, 1, CA::RemovedNote, 9)  //
              }))
        return failed();

    // column
    // (1,5) (1,6)
    // ..... (3,6)
    // (4,5) .....
    if (!test("1.6.934.797342...548..713..8.9.37...7...1.9..6.19457.85973628412641895733187542..",
              R"(
                .------------.------------.-------------.
                | 1  25   6  | 58   9  3  | 4   28  7   |
                | 9  7    3  | 4    2  68 | 16  18  5   |
                | 4  8    25 | 56   7  1  | 3   69  269 |
                :------------+------------+-------------:
                | 8  45   9  | 26   3  7  | 16  15  246 |
                | 7  345  25 | 268  1  68 | 9   35  246 |
                | 6  23   1  | 9    4  5  | 7   23  8   |
                :------------+------------+-------------:
                | 5  9    7  | 3    6  2  | 8   4   1   |
                | 2  6    4  | 1    8  9  | 5   7   3   |
                | 3  1    8  | 7    5  4  | 2   69  69  |
                '------------'------------'-------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(1, 5, CA::RelatedNote, 6), CL(1, 6, CA::RelatedNote, 6), //
                  CL(3, 6, CA::RelatedNote, 6),                               //
                  CL(4, 5, CA::RelatedNote, 6),                               //

                  // Remove
                  CL(3, 3, CA::RemovedNote, 6), //
                  CL(4, 8, CA::RemovedNote, 6)  //
              }))
        return failed();

    // column
    // ..... (1,5)
    // (2,0) .....
    // (6,0) (6,5)
    if (!test(".72.9..1.9.67..42...8.26....432...81...3.82..28.....3..2.97.863397..514286..32759",
              R"(
                .---------------.---------------.---------------.
                | 45   7    2   | 458  9     34 | 356  1   568  |
                | 9    135  6   | 7    158   13 | 4    2   58   |
                | 145  135  8   | 145  2     6  | 359  79  57   |
                :---------------+---------------+---------------:
                | 67   4    3   | 2    56    79 | 569  8   1    |
                | 67   15   159 | 3    1456  8  | 2    79  4567 |
                | 2    8    159 | 156  1456  79 | 569  3   4567 |
                :---------------+---------------+---------------:
                | 15   2    145 | 9    7     14 | 8    6   3    |
                | 3    9    7   | 68   68    5  | 1    4   2    |
                | 8    6    14  | 14   3     2  | 7    5   9    |
                '---------------'---------------'---------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(1, 5, CA::RelatedNote, 1),                               //
                  CL(2, 0, CA::RelatedNote, 1),                               //
                  CL(6, 0, CA::RelatedNote, 1), CL(6, 5, CA::RelatedNote, 1), //

                  // Remove
                  CL(1, 1, CA::RemovedNote, 1), //
                  CL(2, 3, CA::RemovedNote, 1)  //
              }))
        return failed();

    // column
    // (3,5) .....
    // ..... (4,8)
    // (7,5) (7,8)
    if (!test("48.259..1..94638.262.8174.98.4.2.9.7.9..7824.2..934185..8.9172494278..1.7..342.98",
              R"(
                .---------------.------------.--------------.
                | 4    8    37  | 2    5  9  | 36   367  1  |
                | 15   157  9   | 4    6  3  | 8    57   2  |
                | 6    2    35  | 8    1  7  | 4    35   9  |
                :---------------+------------+--------------:
                | 8    135  4   | 156  2  56 | 9    36   7  |
                | 135  9    15  | 156  7  8  | 2    4    36 |
                | 2    67   67  | 9    3  4  | 1    8    5  |
                :---------------+------------+--------------:
                | 35   356  8   | 56   9  1  | 7    2    4  |
                | 9    4    2   | 7    8  56 | 356  1    36 |
                | 7    156  156 | 3    4  2  | 56   9    8  |
                '---------------'------------'--------------'
              )",
              solver::Technique::Skyscraper,
              {
                  // Pattern
                  CL(3, 5, CA::RelatedNote, 6),                               //
                  CL(4, 8, CA::RelatedNote, 6),                               //
                  CL(7, 5, CA::RelatedNote, 6), CL(7, 8, CA::RelatedNote, 6), //

                  // Remove
                  CL(3, 7, CA::RemovedNote, 6), //
                  CL(4, 3, CA::RemovedNote, 6)  //
              }))
        return failed();

    return passed();
}